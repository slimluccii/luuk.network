# Copilot Instructions for luuk.network

## Project Overview
This is an Astro-based website using TypeScript, DatoCMS for content management, and a design token system for consistent styling.

## Core Principles

### 1. Use Design Tokens
- **Always** use CSS custom properties from the generated tokens (`--spacing-*`, `--color-*`, `--typography-*`, `--motion-*`)
- Never hardcode values for spacing, colors, typography sizes, or animation durations
- Import design tokens via `@generated/tokens.css` in layout components
- Reference tokens in styles: `var(--spacing-size-m)`, `var(--color-brand-primary)`, etc.

### 2. TypeScript Best Practices
- **Always** define `Props` interface for components in the frontmatter
- Use `type` imports explicitly: `import type { SomeType } from "./module"`
- Leverage Astro's built-in types: `Polymorphic`, `HTMLAttributes`, `ComponentProps` from `astro/types`
- Never use `any` type - prefer `unknown` or specific types
- Use `satisfies` operator for type validation where appropriate

### 3. Component Structure

#### Component Template
```astro
---
import type { HTMLAttributes, Polymorphic } from "astro/types";
import type { SomeFragment } from "@generated/datocms";

type Props<Tag extends "div" | "section"> = Polymorphic<{
  as?: Tag;
  variant?: "primary" | "secondary";
  someRequiredProp: string;
  someOptionalProp?: boolean;
}>;

const {
  as: Tag = "div",
  variant = "primary",
  someRequiredProp,
  someOptionalProp = false,
  class: className,
  ...props
} = Astro.props;
---

<Tag
  class:list={[
    "component-name",
    { [`component-name--${variant}`]: variant },
    { "component-name--modified": someOptionalProp },
    className
  ]}
  {...props}
>
  <slot />
</Tag>

<style>
  .component-name {
    /* Use design tokens */
    padding: var(--spacing-inset-comfortable);
    color: var(--color-brand-neutral);
    transition: all var(--motion-feedback);
  }
</style>
```

### 4. Styling Guidelines

#### BEM Methodology
- Use BEM naming: `.block`, `.block__element`, `.block--modifier`
- Component root class should match component filename (kebab-case)
- Use `class:list` directive for conditional classes

#### Responsive Design
- Use fluid typography tokens that already include `clamp()` functions
- Media queries should use logical values: `@media (min-width: 500px)`
- Prefer container queries where appropriate

#### CSS Best Practices
- Use logical properties: `inline-size`, `block-size`, `inset-inline-start`, etc.
- Scope global styles with `:global()` selector
- Keep component styles co-located in `<style>` tags
- Use CSS custom properties for component-level theming

### 5. Accessibility Requirements

- **Always** include proper ARIA attributes when needed
- Use semantic HTML elements (`<nav>`, `<main>`, `<article>`, etc.)
- Ensure interactive elements have focus styles
- Include `sr-only` class for screen reader only content
- Add skip links for keyboard navigation
- Icons must have `aria-hidden="true"` unless they have semantic meaning

### 6. Icon Usage

```astro
---
import { Icon } from "@components";
import type { IconName } from "@generated/icons-sprite";
---

<!-- Decorative icon -->
<Icon name="arrow-right" />

<!-- Semantic icon with title -->
<Icon name="warning" title="Warning message" />
```

### 7. Form Components

- Use native HTML form elements with progressive enhancement
- Implement client-side validation with Web Components
- Follow the established FormField pattern with error messages
- Use `<form-field>` wrapper for consistent spacing and error handling

### 8. Internationalization

```astro
---
import { useTranslations } from "src/i18n/utils";
import type { SiteLocale } from "@generated/datocms";

type Props = {
  locale: SiteLocale;
};

const { locale } = Astro.props;
const { t, n, d } = useTranslations(locale);
---

<p>{t("welcome_message")}</p>
<p>{t("items_count", { count: 5 })}</p>
<p>{n(1234.56)}</p>
<p>{d(new Date())}</p>
```

### 9. Data Fetching from DatoCMS

- Use GraphQL fragments defined in `src/datocms/`
- Import generated types from `@generated/datocms`
- Fetch data in page components, pass as props to child components
- Use `Image` component from `@datocms/astro` for responsive images

### 10. Script Handling

```astro
<script>
  // TypeScript is supported by default
  // This script is processed, bundled, and deduplicated
  class MyComponent extends HTMLElement {
    connectedCallback() {
      // Component logic
    }
  }
  
  customElements.define("my-component", MyComponent);
</script>

<!-- For unprocessed scripts -->
<script is:inline>
  // Raw JavaScript, no processing
</script>
```

### 11. Import Aliases

Always use configured path aliases:
- `@components` - Component imports
- `@generated` - Generated files (types, tokens, translations)
- `@layouts` - Layout components
- `@styles` - Style files
- `@utils` - Utility functions
- `@datocms` - DatoCMS related files

### 12. Performance Best Practices

- Use `loading="lazy"` for images below the fold
- Set `priority={true}` on DatoCMS images above the fold
- Leverage Astro's automatic component hydration directives when needed
- Use `prefetch={true}` for internal links (default in config)
- Keep bundle sizes small by importing only what's needed

### 13. File Organization

```
src/
├── components/
│   ├── ComponentName.astro    # Single component
│   └── Blocks/                # Component groups
│       ├── Blocks.astro       # Parent component
│       └── BlockName/         # Complex component
│           └── BlockName.astro
├── datocms/                   # GraphQL queries and fragments
├── i18n/                      # Internationalization
├── layouts/                   # Page layouts
├── pages/                     # Route pages
├── styles/                    # Global styles
└── utils/                     # Utility functions
```

### 14. Testing & Validation

- Run type checking: `astro check`
- Validate HTML semantics and accessibility
- Test responsive behavior with fluid tokens
- Ensure all interactive elements work without JavaScript
- Verify proper error states in forms

### 15. Common Patterns

#### Polymorphic Components
```astro
---
import type { Polymorphic } from "astro/types";

type Props<Tag extends "button" | "a"> = Polymorphic<{
  as: Tag;
}>;

const { as: Tag, ...props } = Astro.props;
---
<Tag {...props}><slot /></Tag>
```

#### Conditional Rendering
```astro
{condition && (
  <div>Conditional content</div>
)}

{items.map(item => (
  <Item key={item.id} {...item} />
))}
```

#### Slot Usage
```astro
<!-- Check if slot has content -->
{Astro.slots.has("header") && (
  <header>
    <slot name="header" />
  </header>
)}

<!-- Default slot -->
<slot>Default content if no slot provided</slot>
```

## Error Prevention

- Never use `style` attribute directly - use CSS classes and design tokens
- Don't hardcode colors, use color tokens from `tokens.json`
- Avoid inline event handlers - use Web Components with event listeners
- Don't skip heading levels for accessibility
- Always provide alt text for images
- Never use `px` values for font-size - use typography tokens
- Don't create new spacing values - use existing spacing tokens

## Resources

- [Astro Documentation](https://docs.astro.build)
- [DatoCMS Astro Integration](https://www.datocms.com/docs/astro)
- [TypeScript in Astro](https://docs.astro.build/en/guides/typescript/)
- [Astro Component Props](https://docs.astro.build/en/basics/astro-components/#component-props)
